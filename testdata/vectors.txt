|===================================|
| FIDO Web Pay (FWP) - Test Vectors |
|===================================|



User FIDO key in JWK format:
{
  "kty": "EC",
  "crv": "P-256",
  "x": "6BKxpty8cI-exDzCkh-goU6dXq3MbcY0cd1LaAxiNrU",
  "y": "mCbcvUzm44j3Lt2b5BPyQloQ91tf2D2V-gzeUxWaUdg",
  "d": "6XxMFXhcYT5QN9w5TIg2aSKsbcj-pj4BnZkK7ZOt4B8"
}


Merchant 'W3C PaymentRequest' (PRCD) data in pretty-printed JSON notation:
{
  "payeeName": "Space Shop",
  "requestId": "7040566321",
  "amount": "435.00",
  "currency": "EUR"
}

Merchant 'hostname' according to the browser: spaceshop.com


Unsigned FWP assertion, here in CBOR 'diagnostic notation':
{
  1: "1.0",
  2: {
    1: "Space Shop",
    2: "7040566321",
    3: "435.00",
    4: "EUR"
  },
  3: "spaceshop.com",
  4: "FR7630002111110020050014382",
  5: "https://banknet2.org",
  6: "0057162932",
  7: "additional stuff...",
  8: {
    1: {
      3: "Android",
      4: "10.0"
    },
    2: {
      3: "Chrome",
      4: "103"
    }
  },
  9: "2022-12-19T10:14:07+01:00",
  -1: {
    1: -7,
    2: {
      1: 2,
      -1: 1,
      -2: h'e812b1a6dcbc708f9ec43cc2921fa0a14e9d5eadcc6dc63471dd4b680c6236b5',
      -3: h'9826dcbd4ce6e388f72edd9be413f2425a10f75b5fd83d95fa0cde53159a51d8'
    }
  }
}

Note that the last element (-1) contains the COSE signature algorithm (ES256) and the FIDO public key (EC/P256) which is also is part of the data to be signed.


The unsigned FWP assertion (binary) converted into a SHA256 hash, here in Base64Url notation:
EwAMQMDh3O2rULIwxwRKf8Au6xrwyONMXkuAIezVi-s
This is subsequently used as FIDO 'challenge'.


****************************************
* FIDO/WebAuthn assertion happens here *
****************************************
Relying party URL: https://mybank.fr

Returned FIDO 'authenticatorData' in hexadecimal notation:
412e175a0f0bdc06dabf0b1db79b97541c08dbacee7e31c97a553588ee922ea70500000017
(here using the UP+UV flags and a zero counter value)

Returned FIDO 'signature' in hexadecimal notation:
3045022100bf83c27dc440efbca6378ca6feab4f170bced28fd41b987098b8d55512ab37a0022074319f72ab29aff969a59b37a067f08267fb31b54a161bb67821d4cf371e75b9

Signed FWP assertion (SAD), here in CBOR 'diagnostic notation':
{
  1: "1.0",
  2: {
    1: "Space Shop",
    2: "7040566321",
    3: "435.00",
    4: "EUR"
  },
  3: "spaceshop.com",
  4: "FR7630002111110020050014382",
  5: "https://banknet2.org",
  6: "0057162932",
  7: "additional stuff...",
  8: {
    1: {
      3: "Android",
      4: "10.0"
    },
    2: {
      3: "Chrome",
      4: "103"
    }
  },
  9: "2022-12-19T10:14:07+01:00",
  -1: {
    1: -7,
    2: {
      1: 2,
      -1: 1,
      -2: h'e812b1a6dcbc708f9ec43cc2921fa0a14e9d5eadcc6dc63471dd4b680c6236b5',
      -3: h'9826dcbd4ce6e388f72edd9be413f2425a10f75b5fd83d95fa0cde53159a51d8'
    },
    3: h'412e175a0f0bdc06dabf0b1db79b97541c08dbacee7e31c97a553588ee922ea70500000017',
    4: h'3045022100bf83c27dc440efbca6378ca6feab4f170bced28fd41b987098b8d55512ab37a0022074319f72ab29aff969a59b37a067f08267fb31b54a161bb67821d4cf371e75b9'
  }
}

The added elements 3,5,4','clientDataJSON' and 'signature' respectively.


The signed FWP assertion as a hex-encoded binary: aa0163312e3002a4016a53706163652053686f70026a3730343035363633323103663433352e30300463455552036d737061636573686f702e636f6d04781b465237363330303032313131313130303230303530303134333832057468747470733a2f2f62616e6b6e6574322e6f7267066a3030353731363239333207736164646974696f6e616c2073747566662e2e2e08a201a20367416e64726f6964046431302e3002a203664368726f6d650463313033097819323032322d31322d31395431303a31343a30372b30313a303020a4012602a401022001215820e812b1a6dcbc708f9ec43cc2921fa0a14e9d5eadcc6dc63471dd4b680c6236b52258209826dcbd4ce6e388f72edd9be413f2425a10f75b5fd83d95fa0cde53159a51d8035825412e175a0f0bdc06dabf0b1db79b97541c08dbacee7e31c97a553588ee922ea705000000170458473045022100bf83c27dc440efbca6378ca6feab4f170bced28fd41b987098b8d55512ab37a0022074319f72ab29aff969a59b37a067f08267fb31b54a161bb67821d4cf371e75b9


*******************************
* FWP encryption happens here *
*******************************

Issuer encryption key in JWK format:
{
  "kty": "OKP",
  "crv": "X25519",
  "x": "6ZoM7yBYlJYNmxwFl4UT3MtCoTv7ztUjpRuKEXrV8Aw",
  "d": "cxfl86EVmcqrR07mWENCf1F_5Ni5mt1ViGyERB6Q1vA"
}


Encrypted FWP assertion (ESAD), here in CBOR 'diagnostic notation:
{
  1: 3,
  2: {
    1: -31,
    3: "x25519:2022:1",
    7: {
      1: 1,
      -1: 4,
      -2: h'54036cadec7ef7748a8be952fa34e1c626d8dcea0fd1105b4181c7f561769305'
    },
    10: h'933a56b03c0040ad14ed55e485de6d71036d9065d0fa7678526c6622d4f9e416b7a5ae35355fb184'
  },
  8: h'4e615522326bfecfcd700fd0b5d0f1e3',
  9: h'e787380251e09e9ad8e1acd0',
  10: h'94f918472807772b332df08f9bb50599406d83ec9bc7aed17064a65970d2b74394c0841b4b020b9eefcaf86829b81ca732b0d28685d0476a2babf3eedba1b8738757b9cbd0e6101c9757de5764cd46f286b88f815d1f44e1a5e2396e22ac881da24e703b297a3e742371cf64211a59eec55f9612c11ff0931eac5a6701747e4eac1620f815b17b78f2cb51fb1bab19bf58771b5bcc80a4c13afd058af2fa577e95b5dd991c1d25d9596de1276cf3dc1cbad3c1385ad6e74b1b61c2049dccf01f56a82bc7982d80e5d4304ddf54db991093a9f8bc4ff35038eafb17c70a9a93aa5192ac5af8641197b88d27beb1f9f2b0d4ec76cc8454fe8ca1fd136ef7ca36dbdaf25054da4797bfcfb13824b2d6b662119cca42d7dc5640337632652c843e99fa121819e767942dfc958b98f4a0dfc31f2a492db9ba93acdc9f5a3635c86ce89807c5579a47e13300e3b4c0d2a2beb538bbde1bd968768af9cf322ee7858803d77edcc22acb564ec55c0fe7d76faa7a1f7ada7040d796d1e96c8634290c79948fdb153008d373dbf9dac51152d8144dac'
}

And as a hex-encoded binary: a5010302a401381e036d7832353531393a323032323a3107a30101200421582054036cadec7ef7748a8be952fa34e1c626d8dcea0fd1105b4181c7f5617693050a5828933a56b03c0040ad14ed55e485de6d71036d9065d0fa7678526c6622d4f9e416b7a5ae35355fb18408504e615522326bfecfcd700fd0b5d0f1e3094ce787380251e09e9ad8e1acd00a59019194f918472807772b332df08f9bb50599406d83ec9bc7aed17064a65970d2b74394c0841b4b020b9eefcaf86829b81ca732b0d28685d0476a2babf3eedba1b8738757b9cbd0e6101c9757de5764cd46f286b88f815d1f44e1a5e2396e22ac881da24e703b297a3e742371cf64211a59eec55f9612c11ff0931eac5a6701747e4eac1620f815b17b78f2cb51fb1bab19bf58771b5bcc80a4c13afd058af2fa577e95b5dd991c1d25d9596de1276cf3dc1cbad3c1385ad6e74b1b61c2049dccf01f56a82bc7982d80e5d4304ddf54db991093a9f8bc4ff35038eafb17c70a9a93aa5192ac5af8641197b88d27beb1f9f2b0d4ec76cc8454fe8ca1fd136ef7ca36dbdaf25054da4797bfcfb13824b2d6b662119cca42d7dc5640337632652c843e99fa121819e767942dfc958b98f4a0dfc31f2a492db9ba93acdc9f5a3635c86ce89807c5579a47e13300e3b4c0d2a2beb538bbde1bd968768af9cf322ee7858803d77edcc22acb564ec55c0fe7d76faa7a1f7ada7040d796d1e96c8634290c79948fdb153008d373dbf9dac51152d8144dac


FWP assertion delivered by the browser:
{
  "paymentNetworkId": "https://banknet2.org",
  "issuerId": "https://mybank.fr/payment",
  "encryptedAuthorization": "pQEDAqQBOB4DbXgyNTUxOToyMDIyOjEHowEBIAQhWCBUA2yt7H73dIqL6VL6NOHGJtjc6g_REFtBgcf1YXaTBQpYKJM6VrA8AECtFO1V5IXebXEDbZBl0Pp2eFJsZiLU-eQWt6WuNTVfsYQIUE5hVSIya_7PzXAP0LXQ8eMJTOeHOAJR4J6a2OGs0ApZAZGU-RhHKAd3KzMt8I-btQWZQG2D7JvHrtFwZKZZcNK3Q5TAhBtLAgue78r4aCm4HKcysNKGhdBHaiur8-7bobhzh1e5y9DmEByXV95XZM1G8oa4j4FdH0ThpeI5biKsiB2iTnA7KXo-dCNxz2QhGlnuxV-WEsEf8JMerFpnAXR-TqwWIPgVsXt48stR-xurGb9YdxtbzICkwTr9BYry-ld-lbXdmRwdJdlZbeEnbPPcHLrTwTha1udLG2HCBJ3M8B9WqCvHmC2A5dQwTd9U25kQk6n4vE_zUDjq-xfHCpqTqlGSrFr4ZBGXuI0nvrH58rDU7HbMhFT-jKH9E273yjbb2vJQVNpHl7_PsTgksta2YhGcykLX3FZAM3YyZSyEPpn6EhgZ52eULfyVi5j0oN_DHypJLbm6k6zcn1o2Nchs6JgHxVeaR-EzAOO0wNKivrU4u94b2Wh2ivnPMi7nhYgD137cwirLVk7FXA_n12-qeh962nBA15bR6WyGNCkMeZSP2xUwCNNz2_naxRFS2BRNrA"
}
